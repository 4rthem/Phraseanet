<?php

require_once __DIR__ . '/../../PhraseanetWebTestCaseAuthenticatedAbstract.class.inc';

use Symfony\Component\Console\Tester\CommandTester;
use \Symfony\Component\Console\Application;
/**
 * Test class for module_console_tasklist.
 * Generated by PHPUnit on 2011-11-03 at 16:11:10.
 */
class module_console_tasklistTest extends PHPUnit_Framework_TestCase
{


  /**
   * @covers module_console_tasklist::execute
   */
  public function testExecute()
  {
    // mock the Kernel or create one depending on your needs
    $application = new Application();
    $application->add(new module_console_tasklist('task:list'));

    $command = $application->find('task:list');
    $commandTester = new CommandTester($command);
    $commandTester->execute(array('command' => $command->getName()));

    $task_manager = new task_manager(appbox::get_instance());
    $lines = explode("\n", trim($commandTester->getDisplay()));

    if(count($task_manager->get_tasks()) > 0)
    {
      $this->assertEquals(count($task_manager->get_tasks()), count($lines));
      foreach($task_manager->get_tasks() as $task)
      {
        $this->assertTrue(strpos($commandTester->getDisplay(), $task->get_title()) !== false);
      }
    }
    else
    {
      $this->assertEquals(1, $n_lines);
    }
  }

}

?>
